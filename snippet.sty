\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{sty/snippet}[Beatify multiple equations with comments and alignment.]

\RequirePackage{xparse}        % detect empty arguments

\makeatletter % Grant access to internal macros (Name contains an @).

%%%%%%%%%%%%%%%%%%%% USER MACROS %%%%%%%%%%%%%%%%%%%%

\NewDocumentCommand {\newsnippet} {m +m} {%
    \NewDocumentCommand {#1} {s} {%
        \RenderSnippet@spt{#1}{##1}{#2}%
    }%
}
\NewDocumentCommand {\renewsnippet} {m +m} {%
    \RenewDocumentCommand {#1} {s} {%
        \RenderSnippet@spt{#1}{##1}{#2}%
    }%
}
\NewDocumentCommand {\providesnippet} {m +m} {%
    \ProvideDocumentCommand {#1} {s} {%
        \RenderSnippet@spt{#1}{##1}{#2}%
    }%
}
\NewDocumentCommand {\declaresnippet} {m +m} {%
    \DeclareDocumentCommand {#1} {s} {%
        \RenderSnippet@spt{#1}{##1}{#2}%
    }%
}

\NewDocumentCommand {\newmathsnippet} {m m} {%
    \newsnippet{#1}{\ensuremath{#2}}%
}
\NewDocumentCommand {\renewmathsnippet} {m m} {%
    \renewsnippet{#1}{\ensuremath{#2}}%
}
\NewDocumentCommand {\providemathsnippet} {m m} {%
    \providesnippet{#1}{\ensuremath{#2}}%
}
\NewDocumentCommand {\declaremathsnippet} {m m} {%
    \declaresnippet{#1}{\ensuremath{#2}}%
}

%%%%%%%%%%%%%%%%%%%% INTERNAL MACROS %%%%%%%%%%%%%%%%%%%%

\NewDocumentCommand {\RenderSnippet@spt} {m m m}
{%
    \relax\ifmmode%
        #3%
    \else%
        \IfBooleanTF{#2}{%
            #3%
        }{% else
            \PackageError{snippet}{Use #1* (whitespace optional) instead of #1. The star variant is required outside math mode}{}%
        }%
    \fi%
}

\NewDocumentCommand {\ThrowStarRequired@spt} {m} {%
\PackageError{\packageName@spt}{Use \detokenize{#1*} (whitespace optional) instead of \detokenize{#1}. The star variant is required outside math mode}{}%
}

\NewDocumentCommand {\WarnDeprecated@spt} {m m} {%
\PackageWarning{\packageName@spt}{Use \detokenize{#1} instead of \detokenize{#2}. The macro is deprecated}%
}

%%%%%%%%%%%%%%%%%%%% INTERNAL VARIABLES %%%%%%%%%%%%%%%%%%%%

\newcommand {\packageName@spt} {snippet}

%%%%%%%%%%%%%%%%%%%% DEPRECATED MACROS %%%%%%%%%%%%%%%%%%%%

\ProvideDocumentCommand {\newmathsymbol} {m m} {%
    \WarnDeprecated@spt{\newmathsnippet}{\newmathsymbol}%
    \newmathsnippet{#1}{#2}%
}
\ProvideDocumentCommand {\renewmathsymbol} {m m} {%
    \WarnDeprecated@spt{\renewmathsnippet}{\renewmathsymbol}%
    \renewmathsnippet{#1}{#2}%
}
\ProvideDocumentCommand {\providemathsymbol} {m m} {%
    \WarnDeprecated@spt{\providemathsnippet}{\providemathsymbol}%
    \providemathsnippet{#1}{#2}%
}
\ProvideDocumentCommand {\declaremathsymbol} {m m} {%
    \WarnDeprecated@spt{\declaremathsnippet}{\declaremathsymbol}%
    \declaremathsnippet{#1}{#2}%
}

\makeatother % Revoke access to internal macros (Name contains an @).